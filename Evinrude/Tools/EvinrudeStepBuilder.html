<html>
<head>
<title>Evinrude Step Builder</title>
<script language="javascript" type="text/javascript">
	function loadJsonFile() {
		var objTable;
		var intRow;
		var intColumnCount;
		var objRowEach;
		var intColumnEach;
		var objCellEach;
		var strKeyName
		var strKeyValue
		try {
			refreshTable();
			var fileToLoad = document.getElementById('fileToLoad').value;
			var file = "file:///" + fileToLoad.split('\\').join('\/')
			//var rawFile = new XMLHttpRequest();
			var rawFile = new ActiveXObject("Microsoft.XMLHTTP");
			rawFile.open("GET", file, false);
			rawFile.onreadystatechange = function() {
				if (rawFile.readyState === 4) {
					if (rawFile.status === 200 || rawFile.status == 0) {
					
						var allText = rawFile.responseText;
						//var	objJsonFile = JSON.parse(allText);
						var objJsonFile = eval("(" + allText + ")");
						var intRow;
						var intRowCount = objJsonFile.steps.length;
						for (intRow = 0; intRow < intRowCount; intRow++) {
							if (intRow > 0) {
								addRow();
							}
							objRowEach = document.getElementById('EvinrudeStepTable').rows[intRow + 1];
							intColumnCount = objRowEach.cells.length;
							for (intColumnEach = 0; intColumnEach < intColumnCount; intColumnEach++) {
								objCellEach = objRowEach.cells[intColumnEach];
								strKeyName = document.getElementById('EvinrudeStepTable').rows[0].cells[intColumnEach].innerHTML;
								strKeyValue = objJsonFile.steps[intRow][strKeyName];
								if (strKeyName == "strTagName") {
									strKeyValue = strKeyValue.toLowerCase();
								}
								switch (objCellEach.childNodes[0].type) {
								case "text":
									objCellEach.childNodes[0].value = strKeyValue;
									break;
								case "select-one":
									selectItemByValue(objCellEach.childNodes[0], strKeyValue);
									break;
								}
							}

						}
					}
				}
			}
			rawFile.send(null);
		} catch (e) {
			alert(e);
		}
	}

	function selectItemByValue(objElement, strValue) {
		for (var intOptionsEach = 0; intOptionsEach < objElement.options.length; intOptionsEach++) {
			if (objElement.options[intOptionsEach].value == strValue)
				objElement.selectedIndex = intOptionsEach;
		}
	}

	function saveTableToJson() {
		try {
			var strKeyName = "";
			var strTextToJson = "{\"steps\":[";
			var objTable = document.getElementById('EvinrudeStepTable');
			var intRowCount = objTable.rows.length;
			var intRow;
			var intColumnCount;
			var objRowEach;
			var intColumnEach;
			var objCellEach;
			for (intRow = 1; intRow < intRowCount; intRow++) {
				strTextToJson = strTextToJson + "{";
				objRowEach = objTable.rows[intRow];
				intColumnCount = objRowEach.cells.length;
				for (intColumnEach = 0; intColumnEach < intColumnCount; intColumnEach++) {
					objCellEach = objRowEach.cells[intColumnEach];
					strKeyName = objTable.rows[0].cells[intColumnEach].innerHTML
					switch (objCellEach.childNodes[0].type) {
					case "text":
						strTextToJson = strTextToJson + "\"" + strKeyName + "\":\"" + objCellEach.childNodes[0].value + "\",";
						break;
					case "select-one":
						strTextToJson = strTextToJson + "\"" + strKeyName + "\":\"" + objCellEach.childNodes[0].options[objCellEach.childNodes[0].selectedIndex].innerHTML + "\",";
						break;
					}
				}
				strTextToJson = strTextToJson.replace(/,+$/, "");
				strTextToJson = strTextToJson + "},";
			}
			strTextToJson = strTextToJson.replace(/,+$/, "");
			strTextToJson = strTextToJson + "],\"link\":[{}]}";
		} catch (e) {
			alert(e);
		}
		var ForAppending = 8;
		var ForWriting = 2
		var TriStateFalse = 0;
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var strnewFile = document.getElementById('fileToLoad').value;
		var file =  strnewFile.split('\\').join('\\\\')
		var newFile = fso.OpenTextFile(file, ForWriting, true, TriStateFalse);
		newFile.Write(strTextToJson);
		newFile.Close();
	}

	function addRow() {
		var objTable = document.getElementById('EvinrudeStepTable');
		var intRowCount = objTable.rows.length;
		var objRowNew = objTable.insertRow(intRowCount);
		var intColumnCount = objTable.rows[0].cells.length;
		for (var i = 0; i < intColumnCount; i++) {
			var objCellNew = objRowNew.insertCell(i);
			objCellNew.innerHTML = objTable.rows[intRowCount - 1].cells[i].innerHTML;
			switch (objCellNew.childNodes[0].type) {
			case "text":
				objCellNew.childNodes[0].value = "";
				break;
			case "checkbox":
				objCellNew.childNodes[0].checked = false;
				break;
			case "select-one":
				objCellNew.childNodes[0].selectedIndex = 0;
				break;
			}
		}
	}

	function insertRow() {
		var objTable = document.getElementById('EvinrudeStepTable');
		var intRowCount = objTable.rows.length;
		for (var intRow = 0; intRow < intRowCount; intRow++) {
			var objRowEach = objTable.rows[intRow];
			var objCheckboxEach = objRowEach.cells[0].childNodes[0];
			if (null != objCheckboxEach && true == objCheckboxEach.checked) {
				objCheckboxEach.checked = false;
				var objRowNew = objTable.insertRow(intRow);
				var intColumnCount = objRowEach.cells.length;
				for (var intColumnEach = 0; intColumnEach < intColumnCount; intColumnEach++) {
					var objCellNew = objRowNew.insertCell(intColumnEach);
					objCellNew.innerHTML = objRowEach.cells[intColumnEach].innerHTML;
					switch (objCellNew.childNodes[0].type) {
					case "text":
						objCellNew.childNodes[0].value = "";
						break;
					case "checkbox":
						objCellNew.childNodes[0].checked = false;
						break;
					case "select-one":
						objCellNew.childNodes[0].selectedIndex = 0;
						break;
					}
				}
				break;
			}
		}
	}

	function deleteRow() {
		try {
			var objTable = document.getElementById('EvinrudeStepTable');
			var intRowCount = objTable.rows.length;
			var blnResponse = false;
			for (var intRowEach = 0; intRowEach < intRowCount; intRowEach++) {
				var objRowEach = objTable.rows[intRowEach];
				var objCheckboxEach = objRowEach.cells[0].childNodes[0];
				if (null != objCheckboxEach && true == objCheckboxEach.checked) {

					if (intRowCount <= 2) {
						alert("Cannot delete all the rows.");
						break;
					}

					if (blnResponse == false) {

						blnResponse = confirm("All rows with checkboxes selected will be deleted. Press OK to continue or Cancel to return");
						if (blnResponse == true) {
						} else {
							break;
						}
					}

					objTable.deleteRow(intRowEach);
					intRowCount--;
					intRowEach--;
				}
			}
		} catch (e) {
			alert(e);
		}
	}
	function refreshTable() {
		var objTable = document.getElementById('EvinrudeStepTable');
		var intRowCount = objTable.rows.length;
		var blnResponse = false;
		for (var intRowEach = 2; intRowEach < intRowCount; intRowEach++) {
			objTable.deleteRow(intRowEach);
			intRowCount--;
			intRowEach--;
		}

		var intColumnCount = objTable.rows[0].cells.length;
		for (var intColumnEach = 0; intColumnEach < intColumnCount; intColumnEach++) {
			var objCellEach = objTable.rows[1].cells(intColumnEach);

			switch (objCellEach.childNodes[0].type) {
			case "text":
				objCellEach.childNodes[0].value = "";
				break;
			case "checkbox":
				objCellEach.childNodes[0].checked = false;
				break;
			case "select-one":
				objCellEach.childNodes[0].selectedIndex = 0;
				break;
			}
		}
	}
</script>
</head>
<body>
	<input type="button" value="Add Row" onclick="addRow()"></input>
	<input type="button" value="Insert Row" onclick="insertRow()"></input>
	<input type="button" value="Delete Row" onclick="deleteRow()"></input>
	<input type="button" value="Refresh Table" onclick="refreshTable()"></input>
<input type="file" style="width: 750px" id="fileToLoad">
	<input type="button" value="Load JSON" onclick="loadJsonFile()"></input>
	<input type="button" value="Save JSON" onclick="saveTableToJson()"></input>

	<table id="EvinrudeStepTable" width="350px" border="1">
		<tr>
			<th>+</th>
			<th>strAction</th>
			<th>strTagName</th>
			<th>strAttributeNames</th>
			<th>strAttributeValues</th>
			<th>strInputValue</th>
			<th>strLogicalName</th>
			<th>intMillisecondsToWait</th>
			<th>blnOptional</th>
			<th>strAssert</th>
			<th>blnPleaseWait</th>
			<th>blnHighlight</th>
			<th>blnScreenshot</th>
			<th>strFunction</th>
			<th>strAssistiveProperties</th>
			<th>blnExitOnFail</th>
			<th>strOutputLinkName</th>
			<th>strOutputValue</th>
			<th>intLoop</th>
		</tr>
		<tr>
			<td><input type="checkbox" name="chk"></input></td>
			<td><select id="strAction">
					<option value=""></option>
					<option value="launch">launch</option>
					<option value="close">close</option>
					<option value="get">get</option>
					<option value="set">set</option>
					<option value="verify">verify</option>
					<option value="sync_visible">sync_visible</option>
					<option value="sync_hidden">sync_hidden</option>
					<option value="sync_enabled">sync_enabled</option>
					<option value="sync_disabled">sync_disabled</option>
					<option value="break">break</option>
			</select></td>
			<td><select id="strTagName">
					<option value=""></option>
					<option value="chrome">chrome</option>
					<option value="firefox">firefox</option>
					<option value="ie">ie</option>
					<option value="opera">opera</option>
					<option value="safari">safari</option>
					<option value="a">a</option>
					<option value="alert">alert</option>
					<option value="body">body</option>
					<option value="button">button</option>
					<option value="div">div</option>
					<option value="h1">h1</option>
					<option value="h2">h2</option>
					<option value="h3">h3</option>
					<option value="h4">h4</option>
					<option value="h5">h5</option>
					<option value="h6">h6</option>
					<option value="img">img</option>
					<option value="input">input</option>
					<option value="p">p</option>
					<option value="select">select</option>
					<option value="span">span</option>
					<option value="table">table</option>
					<option value="td">td</option>
					<option value="textarea">textarea</option>
					<option value="th">th</option>
					<option value="tr">tr</option>
			</select></td>
			<td><input type="text" id="strAttributeNames"></input></td>
			<td><input type="text" id="strAttributeValues"></input></td>
			<td><input type="text" id="strInputValue"></input></td>
			<td><input type="text" id="strLogicalName"></input></td>
			<td><input type="text" id="intMillisecondsToWait"></input></td>
			<td><select id="blnOptional">
					<option value=""></option>
					<option value="true">true</option>
					<option value="false">false</option>
			</select></td>
			<td><select id="strAssert">
					<option value=""></option>
					<option value="off">off</option>
					<option value="value">value</option>
					<option value="visible">visible</option>
					<option value="hidden">hidden</option>
					<option value="enabled">enabled</option>
					<option value="disabled">disabled</option>
			</select></td>
			<td><select id="blnPleaseWait">
					<option value=""></option>
					<option value="true">true</option>
					<option value="false">false</option>
			</select></td>
			<td><select id="blnHighlight">
					<option value=""></option>
					<option value="true">true</option>
					<option value="false">false</option>
			</select></td>
			<td><select id="blnScreenshot">
					<option value=""></option>
					<option value="true">true</option>
					<option value="false">false</option>
			</select></td>
			<td><input type="text" id="strFunction"></input></td>
			<td><input type="text" id="strAssistiveProperties"></input></td>
			<td><select id="blnExitOnFail">
					<option value=""></option>
					<option value="true">true</option>
					<option value="false">false</option>
			</select></td>
			<td><input type="text" id="strOutputLinkName"></input></td>
			<td><input type="text" id="strOutputValue"></input></td>
			<td><input type="text" id="intLoop"></input></td>
		</tr>
	</table>
</body>
</html>